import { useState, useEffect } from "react";
import { useMenuContext } from "../../context/MenuContext";
import { Link } from "react-router-dom";
export default function UserMenu() {
  const [isAnimating, setIsAnimating] = useState(false);
  const { isMenuOpen, openSpecificMenu } = useMenuContext();
  const menuId = "userMenu";
  const isOpen = isMenuOpen(menuId);

  useEffect(() => {
    if (isOpen) {
      setIsAnimating(true);
    } else if (isAnimating) {
      const timer = setTimeout(() => {
        setIsAnimating(false);
      }, 200);

      return () => clearTimeout(timer);
    }
  }, [isOpen, isAnimating]);

  const toggleUserMenu = () => {
    if (isOpen) {
      openSpecificMenu(null);
    } else {
      openSpecificMenu(menuId);
    }
  };

  return (
    <div className="relative z-[100] flex flex-col gap-2">
      <div
        onClick={toggleUserMenu}
        className="flex items-center hover:opacity-80 flex-shrink-0 cursor-pointer transition-all duration-300 gap-2 rounded-full px-2 py-1 bg-accent-200/60 text-sm"
      >
        <div className="flex items-center gap-1">
          <img
            src="/assets/images/project/test_avatar.png"
            alt="avatar"
            className="w-7 h-7 rounded-full"
          />
          kinza
        </div>
        <svg
          width="19"
          height="18"
          viewBox="0 0 19 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M6.73092 14.7802C6.59032 14.6396 6.51133 14.4489 6.51133 14.25C6.51133 14.0511 6.59032 13.8604 6.73092 13.7198L11.4507 9L6.73092 4.28025C6.65929 4.21107 6.60215 4.12831 6.56284 4.0368C6.52354 3.9453 6.50285 3.84689 6.50198 3.7473C6.50112 3.64772 6.52009 3.54896 6.5578 3.45679C6.59551 3.36461 6.6512 3.28087 6.72162 3.21045C6.79204 3.14003 6.87578 3.08434 6.96795 3.04663C7.06013 3.00892 7.15888 2.98995 7.25847 2.99081C7.35805 2.99168 7.45647 3.01237 7.54797 3.05167C7.63948 3.09098 7.72223 3.14812 7.79142 3.21975L13.0414 8.46975C13.182 8.6104 13.261 8.80113 13.261 9C13.261 9.19887 13.182 9.3896 13.0414 9.53025L7.79142 14.7802C7.65077 14.9209 7.46004 14.9998 7.26117 14.9998C7.0623 14.9998 6.87157 14.9209 6.73092 14.7802Z"
            fill="#787E87"
          />
        </svg>
      </div>

      {(isOpen || isAnimating) && (
        <div
          className="absolute top-full z-50 right-0 w-full min-w-[180px] bg-accent-200 rounded-lg px-2.5 py-5 mt-2 shadow-lg"
          style={{
            animation: isOpen ? "fadeIn 0.2s forwards" : "fadeOut 0.2s forwards"
          }}
        >
          <div className="flex flex-col text-sm w-full gap-4">
            <div className="flex flex-col gap-4">
              <Link to="/profile" className="account-item">
                <svg
                  width="14"
                  height="18"
                  viewBox="0 0 14 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M11.7951 10.6667C12.0413 10.6666 12.2851 10.715 12.5126 10.8091C12.7401 10.9033 12.9468 11.0413 13.1209 11.2153C13.295 11.3894 13.4331 11.596 13.5274 11.8235C13.6216 12.0509 13.6701 12.2947 13.6701 12.5409V13.3059C13.67 13.7838 13.5206 14.2496 13.2426 14.6384C11.9543 16.4409 9.85011 17.3334 7.0001 17.3334C4.14844 17.3334 2.04594 16.44 0.760938 14.6359C0.484541 14.2478 0.335985 13.7832 0.335938 13.3067V12.54C0.335828 12.2939 0.384224 12.0501 0.478361 11.8226C0.572498 11.5951 0.71053 11.3884 0.884574 11.2143C1.05862 11.0401 1.26526 10.902 1.4927 10.8078C1.72014 10.7135 1.96392 10.665 2.2101 10.665H11.7943L11.7951 10.6667ZM7.0001 0.670044C8.10517 0.670044 9.16498 1.10903 9.94638 1.89043C10.7278 2.67183 11.1668 3.73164 11.1668 4.83671C11.1668 5.94178 10.7278 7.00159 9.94638 7.78299C9.16498 8.56439 8.10517 9.00338 7.0001 9.00338C5.89504 9.00338 4.83523 8.56439 4.05383 7.78299C3.27242 7.00159 2.83344 5.94178 2.83344 4.83671C2.83344 3.73164 3.27242 2.67183 4.05383 1.89043C4.83523 1.10903 5.89504 0.670044 7.0001 0.670044Z"
                    fill="white"
                  />
                </svg>
                Профиль
              </Link>
              <div className="h-[1px] w-full bg-white/5"></div>
            </div>
            <div className="flex flex-col gap-4">
              <div className="account-item">
                <svg
                  width="19"
                  height="18"
                  viewBox="0 0 19 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M0 2V14.75C0 16.5449 1.45508 18 3.25 18H15.25C17.0449 18 18.5 16.5449 18.5 14.75V6.25C18.5 4.71321 17.4333 3.42555 16 3.08697V2.25C16 1.00736 14.9926 0 13.75 0H2.25C1.09186 0 0.138093 0.875013 0.0137322 2H0ZM2.25 3C1.83579 3 1.5 2.66421 1.5 2.25C1.5 1.83579 1.83579 1.5 2.25 1.5H13.75C14.1642 1.5 14.5 1.83579 14.5 2.25V3H2.25ZM13.25 10H15.25C15.6642 10 16 10.3358 16 10.75C16 11.1642 15.6642 11.5 15.25 11.5H13.25C12.8358 11.5 12.5 11.1642 12.5 10.75C12.5 10.3358 12.8358 10 13.25 10Z"
                    fill="#1AFF34"
                  />
                </svg>
                Пополнение
              </div>
              <div className="h-[1px] w-full bg-white/5"></div>
            </div>
            <div className="flex flex-col gap-4">
              <Link to="/market" className="account-item">
                <svg
                  width="16"
                  height="12"
                  viewBox="0 0 16 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6 10H10C10.5523 10 11 10.4477 11 11C11 11.5128 10.614 11.9355 10.1166 11.9933L10 12H6C5.44772 12 5 11.5523 5 11C5 10.4872 5.38604 10.0645 5.88338 10.0067L6 10H10H6ZM4 5H12C12.5523 5 13 5.44772 13 6C13 6.51284 12.614 6.93551 12.1166 6.99327L12 7H4C3.44772 7 3 6.55228 3 6C3 5.48716 3.38604 5.06449 3.88338 5.00673L4 5H12H4ZM1 0H15C15.5523 0 16 0.447715 16 1C16 1.51284 15.614 1.93551 15.1166 1.99327L15 2H1C0.447715 2 0 1.55228 0 1C0 0.487164 0.38604 0.0644928 0.883379 0.0067277L1 0H15H1Z"
                    fill="#8B52FF"
                  />
                </svg>
                Офферы
              </Link>
              <Link to="/market" className="account-item">
                <svg
                  width="19"
                  height="16"
                  viewBox="0 0 19 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M18.5711 15.5H16.7854M0.892578 15.5H3.21401M3.21401 15.5V7.28572C3.21401 3.53807 6.25207 0.5 9.99972 0.5V0.5C13.7474 0.5 16.7854 3.53807 16.7854 7.28572V15.5M3.21401 15.5H6.60686M16.7854 15.5H13.3926M13.3926 15.5C13.3926 15.5 13.7497 9.25 13.3926 9.25V9.25C10.8065 9.25 9.19297 9.25 6.60686 9.25V9.25C6.42829 9.25 6.60686 15.5 6.60686 15.5M13.3926 15.5H6.60686M18.5711 3.71429H0.892578"
                    stroke="#8B52FF"
                  />
                </svg>
                Витрина
              </Link>
              <Link to="/inventory" className="account-item">
                <svg
                  width="16"
                  height="20"
                  viewBox="0 0 16 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M1.5028 2.62704L1.5 4.75V15.2542C1.5 17.0491 2.95507 18.5042 4.75 18.5042L13.3663 18.5045C13.0573 19.3782 12.224 20.0042 11.2444 20.0042H4.75C2.12665 20.0042 0 17.8776 0 15.2542V4.75C0 3.76929 0.627445 2.93512 1.5028 2.62704ZM13.75 0C14.9926 0 16 1.00736 16 2.25V15.25C16 16.4926 14.9926 17.5 13.75 17.5H4.75C3.50736 17.5 2.5 16.4926 2.5 15.25V2.25C2.5 1.00736 3.50736 0 4.75 0H13.75Z"
                    fill="#8B52FF"
                  />
                </svg>
                Инвентарь
              </Link>
              <div className="h-[1px] w-full bg-white/5"></div>
            </div>
            <div className="flex flex-col gap-4">
              <div className="account-item">
                <svg
                  width="21"
                  height="21"
                  viewBox="0 0 21 21"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M14.5002 0C11.4627 0 9.00023 2.46243 9.00023 5.5C9.00023 5.94322 9.0528 6.37496 9.15228 6.78899L0.84099 15.1003C-0.280331 16.2216 -0.280329 18.0396 0.840991 19.1609C1.96231 20.2823 3.78033 20.2823 4.90165 19.1609L9.01554 15.0471C9.0996 13.8257 9.52109 12.6971 10.1875 11.7538L3.84099 18.1003C3.30546 18.6358 2.43718 18.6358 1.90165 18.1003C1.36612 17.5648 1.36612 16.6965 1.90165 16.1609L10.5248 7.53783C10.7258 7.33677 10.7959 7.0393 10.7057 6.76964C10.5726 6.37169 10.5002 5.94506 10.5002 5.5C10.5002 3.29086 12.2911 1.5 14.5002 1.5C14.6415 1.5 14.781 1.5073 14.9183 1.52153L13.0737 3.36612C12.5855 3.85427 12.5855 4.64573 13.0737 5.13388L14.8666 6.92678C15.3547 7.41493 16.1462 7.41493 16.6344 6.92678L18.4787 5.08239C18.4929 5.21955 18.5002 5.35886 18.5002 5.5C18.5002 7.04643 17.6227 8.38789 16.3384 9.05357C16.9902 9.13751 17.6118 9.318 18.1883 9.58024C19.3011 8.5738 20.0002 7.11855 20.0002 5.5C20.0002 4.73337 19.8429 4.00153 19.5582 3.33652C19.4602 3.10771 19.2551 2.94241 19.0107 2.8953C18.7663 2.8482 18.5144 2.92542 18.3384 3.10142L15.7505 5.68934L14.3111 4.25L16.8991 1.66198C17.0751 1.48599 17.1524 1.23414 17.1053 0.989743C17.0582 0.745342 16.8929 0.540226 16.6641 0.442231C15.999 0.157349 15.267 0 14.5002 0ZM12.2772 11.9756C12.592 13.0659 11.9376 14.1993 10.836 14.4718L10.2518 14.6164C10.2069 14.9041 10.1836 15.1992 10.1836 15.5001C10.1836 15.8147 10.2091 16.1232 10.2582 16.4235L10.7976 16.5534C11.9102 16.8213 12.5715 17.9663 12.2476 19.0639L12.0613 19.6951C12.5005 20.0808 13.0009 20.3939 13.5455 20.6167L14.0388 20.098C14.8273 19.2687 16.1496 19.2689 16.9379 20.0985L17.4366 20.6232C17.9801 20.403 18.4801 20.0928 18.9194 19.7103L18.7214 19.0244C18.4066 17.9342 19.061 16.8007 20.1626 16.5282L20.7463 16.3838C20.7912 16.0961 20.8145 15.8009 20.8145 15.5001C20.8145 15.1853 20.789 14.8767 20.7399 14.5764L20.2009 14.4466C19.0884 14.1787 18.4271 13.0337 18.751 11.9362L18.9371 11.3053C18.498 10.9196 17.9975 10.6064 17.4529 10.3835L16.9598 10.9021C16.1713 11.7313 14.849 11.7311 14.0607 10.9016L13.5619 10.3767C13.0184 10.5969 12.5184 10.9071 12.0791 11.2894L12.2772 11.9756ZM15.4991 17.0001C14.6984 17.0001 14.0494 16.3285 14.0494 15.5001C14.0494 14.6716 14.6984 14.0001 15.4991 14.0001C16.2997 14.0001 16.9487 14.6716 16.9487 15.5001C16.9487 16.3285 16.2997 17.0001 15.4991 17.0001Z"
                    fill="#787E87"
                  />
                </svg>
                Поддержка
              </div>
              <div className="account-item !text-red-100">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="0.5"
                    y="0.5"
                    width="23"
                    height="23"
                    rx="11.5"
                    stroke="white"
                    stroke-opacity="0.05"
                  />
                  <path
                    d="M8.10485 8.19355L8.14645 8.14645C8.32669 7.9662 8.6103 7.95234 8.80645 8.10485L8.85355 8.14645L12 11.2925L15.1464 8.14645C15.3417 7.95118 15.6583 7.95118 15.8536 8.14645C16.0488 8.34171 16.0488 8.65829 15.8536 8.85355L12.7075 12L15.8536 15.1464C16.0338 15.3267 16.0477 15.6103 15.8951 15.8064L15.8536 15.8536C15.6733 16.0338 15.3897 16.0477 15.1936 15.8951L15.1464 15.8536L12 12.7075L8.85355 15.8536C8.65829 16.0488 8.34171 16.0488 8.14645 15.8536C7.95118 15.6583 7.95118 15.3417 8.14645 15.1464L11.2925 12L8.14645 8.85355C7.9662 8.67331 7.95234 8.3897 8.10485 8.19355L8.14645 8.14645L8.10485 8.19355Z"
                    fill="#FF4E4E"
                  />
                </svg>
                Выйти
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
